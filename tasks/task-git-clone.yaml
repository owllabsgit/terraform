apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: fetch-source-task
  namespace: dev
spec:
  params:
    - name: repo-url
      type: string
      description: Git repository URL
    - name: revision
      type: string
      description: Branch or tag
      default: main
  workspaces:
    - name: output
      description: Directory to clone repo into
  steps:
    - name: clone
      image: alpine/git
      workingDir: $(workspaces.output.path)
      env:
        - name: HOME
          value: /tekton/home
      script: |
        #!/bin/sh
        echo "📊 === GIT CLONE STARTED ==="
        echo "📦 Repo: $(params.repo-url)"
        echo "🌀 Branch/Tag/Commit: $(params.revision)"
        echo "📁 Target directory: $(workspaces.output.path)"
        echo "🔽 Cloning repository..."
        git clone --depth=1 --branch $(params.revision) $(params.repo-url) . && echo "✅ Clone successful"
        echo "🔍 Getting latest commit info..."
        git log -1
        echo "📋 File list after clone:"
        ls -la
        echo "📊 === GIT CLONE COMPLETED ==="

