# task-git-clone.yaml
apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: git-clone
  namespace: dev
spec:
  params:
    - name: url
      type: string
      description: Git repository URL
    - name: revision
      type: string
      description: Git branch, tag, or commit
      default: main

  workspaces:
    - name: output
      description: The workspace to clone the repo into

  steps:
    - name: clone
      image: alpine/git
      workingDir: $(workspaces.output.path)
      env:
        - name: HOME
          value: /tekton/home
      script: |
        #!/bin/sh
        echo "📊 === GIT CLONE STARTED ==="
        echo "📦 Repo: $(params.url)"
        echo "🌀 Branch/Tag/Commit: $(params.revision)"
        echo "📁 Target directory: $(workspaces.output.path)"
        
        echo "🔽 Cloning repository..."
        git clone --depth=1 --branch $(params.revision) $(params.url) . && echo "✅ Clone successful"

        echo "🔍 Getting latest commit info..."
        git log -1

        echo "📋 File list after clone:"
        ls -la

        echo "📊 === GIT CLONE COMPLETED ==="
